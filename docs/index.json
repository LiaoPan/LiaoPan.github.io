[
{
	"uri": "https://LiaoPan.github.io/dipy/basic/",
	"title": "快速入门",
	"tags": [],
	"description": "",
	"content": "快速入门 本教程知识点：\n导入和保存dMRI的NIfTI数据 绘制与查看dMRI影像数据 读取bval和bvec文件 Jupyter已省略部分内容，请点击这里全屏显示 "
},
{
	"uri": "https://LiaoPan.github.io/freesurfer/installation/",
	"title": "FreeSurfer教程 #1. 安装",
	"tags": [],
	"description": "",
	"content": "安装方法简述 根据自己系统下载对应的安装包（FreeSurfer 7.3.2 ~5G） 通过网址(https://surfer.nmr.mgh.harvard.edu/registration.html),获取license.txt,将其放置在FreeSufer的安装目录下。 依次执行下述脚本，设置环境变量,注意freesurfer的版本7.3.2需要替换成自己安装的版本。 shell $ export FREESURFER_HOME=/Applications/freesurfer/7.3.2 $ export SUBJECTS_DIR=$FREESURFER_HOME/subjects $ source $FREESURFER_HOME/SetUpFreeSurfer.sh -------- freesurfer-darwin-macOS-7.3.2-20200429-3a03ebd -------- Setting up environment for FreeSurfer/FS-FAST (and FSL) WARNING: /Users/synpro/freesurfer/fsfast does not exist FREESURFER_HOME /Applications/freesurfer/7.3.2 FSFAST_HOME /Users/synpro/freesurfer/fsfast FSF_OUTPUT_FORMAT nii.gz SUBJECTS_DIR /Applications/freesurfer/7.3.2/subjects MNI_DIR /Users/synpro/freesurfer/mni $ which freeview /Applications/freesurfer/7.3.2/bin/freeview 注意上述方式时临时有效，即仅对当前打开的终端有效，关闭该终端后，上述设置都会失效。\n永久设置环境变量方法： 将上述脚本写入~/.bash_profile文件中,操作命令如下： shell $ vi ~/.bash_profile #打开该文本，写入内容(若不熟悉vim，请使用其他工具打开即可); # FREESURFER export FREESURFER_HOME=/Applications/freesurfer/7.3.2 export SUBJECTS_DIR=$FREESURFER_HOME/subjects source $FREESURFER_HOME/SetUpFreeSurfer.sh $ source .bash_profile # 让设置立即生效 需要注意的是，上面的设置默认使用bash，如果你在Mac上使用的是zsh等shell工具，需要再做如下配置，来达到环境变量设置的永久生效。\n1.$ vim ~/.zshrc\n2.在开头添加以下内容：\nif [ -f ~/.bash_profile ]; then source ~/.bash_profile fi 3.使用下面的命令使之立即生效 $ source ~/.zshrc\n之后，每次打开新终端都可以正常使用啦。但每次都输出该信息太丑了，如图:\nLast login: Sat Feb 4 17:38:25 on ttys012 -------- freesurfer-darwin-macOS-7.3.2-20220804-6354275 -------- Setting up environment for FreeSurfer/FS-FAST (and FSL) FREESURFER_HOME /Applications/freesurfer/7.3.2 FSFAST_HOME /Applications/freesurfer/7.3.2/fsfast FSF_OUTPUT_FORMAT nii.gz SUBJECTS_DIR /Applications/freesurfer/7.3.2/subjects MNI_DIR /Applications/freesurfer/7.3.2/mni 那怎么可以隐藏掉，方法如下：打开~/.bash_profile文件，删除或者注释掉 source $FREESURFER_HOME/SetUpFreeSurfer.sh,然后将上述终端输出消息和echo $PATH后的FreeSurfer相关信息，改为如下格式，并写入.bash_profile文件。 ~/.bash_profile # FREESURFER export FREESURFER_HOME=/Applications/freesurfer/7.3.2 export SUBJECTS_DIR=$FREESURFER_HOME/subjects # source $FREESURFER_HOME/SetUpFreeSurfer.sh export PATH=/Applications/freesurfer/7.3.2/bin:/Applications/freesurfer/7.3.2/fsfast/bin:/Applications/freesurfer/7.3.2/mni/bin:$PATH export FSFAST_HOME=/Applications/freesurfer/7.3.2/fsfast export FSF_OUTPUT_FORMAT=nii.gz export SUBJECTS_DIR=/Applications/freesurfer/7.3.2/subjects export MNI_DIR=/Applications/freesurfer/7.3.2/mni 参考 官网安装指导 https://surfer.nmr.mgh.harvard.edu/fswiki//FS7_mac "
},
{
	"uri": "https://LiaoPan.github.io/mrtrix/basic/",
	"title": "MRtrix3教程 #1 快速入门",
	"tags": [],
	"description": "",
	"content": " 相关知识点 基础概念 1. T1像与T2像 2. 白质的结构 3.扩散梯度（Diffusion Gradient）与B值（B-value） 4.B向量（B-vectors） 5.张量建模 6.其他的扩散衡量指标 7.扩散张量成像的缺点：交叉纤维问题 MRtrix Viewer使用 BTC_preop（Brain Tumor Connectomics Data）数据下载 MRtrix数据格式与格式转换 检查Bvals和Bvecs 学习参考 MRtrix是一个用于分析扩散数据的软件包。与张量拟合技术相比，MRtrix的一个显著优势是他们的约束球形解卷方法，或称CSD(Constrained spherical deconvolution)；该方法将每个体素的扩散信号解卷为一系列重叠的纤维束,这就减少了在拟合张量时可能出现的纤维交叉问题。\n除了MRtrix团队创建的命令库之外，该软件封装了FSL的部分命令：特别是topup和eddy这两个命令。如果你还没有安装FSL软件，请下载并安装fMRI软件包FSL。\n相关知识点 学习使用fixel-based分析方法来量化每个体素的白质纤维密度 学习怎么使用概率纤维束成像创建纤维束图 学习如何创建连接体(connectomes)以及如何可视化连接不同大脑区域的纤维数量 基础概念 1. T1像与T2像 在T1或解剖扫描中，白质比灰质浅，而灰质又比脑脊液浅；在T2或功能扫描中，相对强度被翻转。 典型的T1加权（解剖）和 T2加权（功能）图像。注意从T1加权成像到T2加权成像时组织类型的相对强度是如何反转的。\n然而，还有其他类型的图像可以通过MRI扫描仪获得。在本节中，我们将重点讨论扩散加权核磁共振成像，或称dMRI，它测量大脑不同部位的相对扩散性\u0026ndash;特别是在白质束内。\n2. 白质的结构 为什么dMRI会关注白质束？想象一下剥开一根奶酪条，然后想象一下剥开大脑\u0026ndash;就像奶酪条一样，大脑有首选的撕裂方向。这些方向与底层白质束相对应，白质束是厚厚的有髓神经元束（myelinated neurons），连接着大脑的附近和遥远的部分。例如，下纵束(inferior longitudinal fasciculus)连接大脑的视觉和颞部区域，而钩束(uncinate fasciculus)则连接大脑的颞部和下额部。这些神经束沿着大脑的所有三个维度行进，它们可能相互平行或相互交叉。\nIllustration of several main white matter tracts. Figure taken from Thiebaut et al., 2015. 大脑的白质因其颜色而得名；这些神经元是高度髓鞘化的，这意味着它们有一层厚厚的脂质涂层，既能使它们绝缘，又有助于电脉冲的传输，就像绝缘的电线。相比之下，灰质神经元则相对没有髓鞘，这使得特定区域内的神经元密度更高。\n如果对Diffusion的历史感兴趣，详情请查看\n3.扩散梯度（Diffusion Gradient）与B值（B-value） 扩散梯度由以下参数生成：\nThe magnitude of diffusion gradient (G); The time between gradients (𝚫) ; T duration of diffusion gradient (𝜹). 这些可以组合成一个方程式，即所谓的b值，如下图所示。 请注意，b值与梯度的大小、梯度的持续时间和梯度之间的时间成正比；如果这些参数中的任何一个增加，b值也会随之增加。\n下图所示b值为0的扩散加权图像与典型的T2加权图像几乎相同\u0026ndash;脑脊液（CSF）是亮的，灰质是暗的。当我们增加b值时，我们看到在大脑的特定部位，主要是白质内有更大的信号损失。这是因为这些白质束内的水主要沿着束的方向扩散，生成的图像显示出相应的低信号。(较高的b值也使图像更容易受到图像伪影的影响，如运动和被称为涡流（eddy）的磁流）。 较高的b值将对检测扩散更敏感，但存在更多噪声和更易受振动伪影影响的风险。\n以一个以上的b值获取的扩散图像被称为多壳获取(multi-shell acquisitions)。这可以对扩散的方向进行更精细的区分。因为根据扩散量，图像将在每个 b 值处显示不同量的信号损失。\n4.B向量（B-vectors） 到目前为止，我们已经学会了如何应用扩散梯度，以及如何解释图像中产生的信号。为了完善我们对扩散图像如何产生的理解，我们还需要知道应用梯度的方向。这些方向被称为b-vectors，或简称bvecs。你会注意到，一旦下载了扩散加权扫描的数据，会有两个文本文件\u0026ndash;一个通常有后缀**.bval**，表示b值，另一个有后缀**.bvec**，代表b向量。\n假设收集了40张扩散加权图像，且第一个volume的b值为0，其余volume的b值为1000。bvals文件将有40个条目，每个bval对应于扩散加权图像中的一个独立容积。另一方面，bvecs文件将有40个三元组数字，表示该volume在X、Y和Z方向的扩散梯度方向。如果我们知道梯度的方向和大小，我们可以根据从这些体素获得的信号的变化，对沿梯度的扩散进行有根据的猜测。\nB-values示例 B-vectors示例 0 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 0 0 0.98807364702224 0.01873399689793 0.10248889029026 -0.60841137170791 0.11875726282596 0.83128935098648 0.8792484998703 0.29209038615226 0.97650814056396 -0.45731022953987 -0.26519000530242 -0.34403458237648 0.3694197833538 -0.5363900065422 0.69562232494354 0.79384189844131 -0.8140320777893 -0.15647158026695 -0.05976745858788 -0.8508283495903 0.54968833923339 -0.86733847856521 -0.96609008312225 0.33223336935043 0.17501354217529 -0.22683978080749 -0.78282612562179 -0.01112493406981 -0.23269833624363 0.91476505994796 -0.67205339670181 -0.23402217030525 0.4485667347908 0.18897378444671 0.94987839460372 -0.9148513674736 -0.44173404574394 -0.73895621299743 0.79589116573333 -0.57393205165863 0.60627329349517 0.05053876712918 -0.64032816886901 -0.00203162245452 -0.65047174692153 -0.05030425265431 0.52077239751815 -0.77435040473938 -0.46209508180618 -0.31149512529373 0.72376120090484 0.35057383775711 0.58841001987457 0.30768102407455 0.58442068099975 -0.43342873454093 0.60935580730438 0.21404276788234 -0.14940990507602 -0.08567165583372 -0.44128519296646 -0.42076206207275 0.77442812919616 0.26836225390434 -0.9886794090271 -0.01840304397046 -0.10154163837432 0.60881024599075 -0.11891078948974 -0.83279365301132 -0.87748628854751 -0.2911439538002 -0.97587263584137 0.45687541365623 0.2644036412239 0.34314483404159 -0.37085926532745 0.53519117832183 -0.69378554821014 -0.79480296373367 0.8121600151062 0.15640883147716 0.0600587055087 0.852090716362 -0.54919642210006 0.86885839700698 0.96635591983795 -0.33167579770088 -0.17399430274963 0.22716110944747 0.78298610448837 0.01114399824291 0.23385895788669 -0.91456174850463 0.6740972995758 0.23286212980747 -0.44666454195976 -0.18938872218132 -0.95080780982971 0.91358888149261 0.44201084971427 0.73829895257949 -0.79423487186431 0.5715285539627 -0.60760217905044 -0.05102515220642 0.63832122087478 0.00161422998644 0.65151822566986 0.05034917593002 -0.52154493331909 0.77315002679824 0.46328803896904 0.31260219216346 -0.72411864995956 -0.35144120454788 -0.58741247653961 -0.3066479563713 -0.58275157213211 0.43335115909576 -0.61113619804382 -0.21487313508987 0.15031689405441 0.08529827743768 0.43970343470573 0.42256951332092 -0.77373939752578 -0.26831793785095 0 0 -0.01852251589298 0.99980324506759 0.65190172195434 0.77669501304626 0.51643615961074 0.24059402942657 0.11685247719287 0.9260526895523 0.1235506683588 0.85478085279464 0.85505563020706 0.64182126522064 0.37680619955062 0.68586140871048 0.09719203412532 0.50450026988983 0.05807575210928 0.54915863275528 0.96547383069992 0.4169929921627 0.83072793483734 0.1662128418684 0.24979101121425 0.7805278301239 0.19109116494655 0.95903354883194 0.61787110567092 0.36186653375625 0.73179537057876 0.40054687857627 0.23983028531074 0.15332546830177 0.19694779813289 0.11983390152454 0.24672436714172 0.22436074912548 0.89713984727859 0.64289963245391 0.39663499593734 0.03941979259252 0.51400256156921 0.72016698122024 0.40433484315872 0.82592779397964 0.60496312379837 0.3299603164196 0.7809572815895 0.47501924633979 0.56527525186538 0.39308729767799 0.67895883321762 0.67152732610702 0.68220138549804 0.50802809000015 0.41673135757446 0.81480491161346 0.23104956746101 0.87857925891876 0.07421392202377 0.90127205848693 0.31627905368804 0.14664776623249 0.59513312578201 0.95450747013092 0.01850401610136 -0.99982780218124 -0.64990043640136 -0.7771503329277 -0.51860928535461 -0.24067203700542 -0.11694828420877 -0.92531460523605 -0.12353691458702 -0.85404860973358 -0.85365968942642 -0.6399946808815 -0.37781903147697 -0.68439275026321 -0.0959820151329 -0.50524860620498 -0.05786505714058 -0.5474424958229 -0.96439582109451 -0.41736420989036 -0.83053159713745 -0.16672849655151 -0.24981169402599 -0.77884089946746 -0.18985091149807 -0.95970767736435 -0.61819595098495 -0.36017289757728 -0.7332512140274 -0.40044379234314 -0.24039900302887 -0.15302035212516 -0.19559489190578 -0.12080664187669 -0.24619971215725 -0.22405302524566 -0.89700889587402 -0.64234739542007 -0.39595165848732 -0.03925511986017 -0.51513165235519 -0.72206115722656 -0.40336072444915 -0.82375878095626 -0.60597515106201 -0.33166021108627 -0.78185319900512 -0.47429451346397 -0.56685864925384 -0.39410242438316 -0.67933368682861 -0.67376309633255 -0.68098336458206 -0.50633686780929 -0.41543397307395 -0.81643337011337 -0.23181574046611 -0.87980186939239 -0.07386588305234 -0.9025894999504 -0.31557491421699 -0.14773198962211 -0.59484159946441 -0.95507723093032 0 0 -0.15286396443843 -0.00651476159691 0.75134563446044 -0.16303530335426 -0.84805089235305 -0.50107139348983 0.46180909872055 0.23897625505924 0.17654202878475 0.24539165198803 0.44559413194656 0.68535083532333 -0.849438726902 0.49181297421455 0.71180284023284 -0.33955046534538 0.57790917158126 0.82093930244445 0.25355103611946 -0.31969979405403 0.08794292062521 -0.4691452383995 -0.06537938863039 0.529525578022 0.96584397554397 -0.16970072686672 -0.07361198216676 0.93216359615325 -0.64056777954101 0.05260347947478 -0.7005894780159 0.96006506681442 0.87177950143814 -0.97464287281036 -0.19198505580425 0.33572205901145 -0.00334380893036 0.2015535980463 0.45742538571357 0.81795364618301 -0.60682290792465 -0.69195765256881 0.65306454896926 0.56377238035202 -0.45924523472786 -0.94265359640121 -0.34482169151306 0.41801697015762 -0.68332421779632 -0.86513191461563 -0.12322624027729 -0.65280097723007 0.43402189016342 0.80451220273971 0.69626688957214 -0.38500982522964 -0.75848639011383 -0.42694765329361 -0.98598629236221 -0.42469879984855 0.83978271484375 -0.89523947238922 0.21465709805488 -0.12998943030834 0.14889819920063 0.00240560458041 -0.75320565700531 0.15933430194854 0.84670227766037 0.49852964282035 -0.46512472629547 -0.24295699596405 -0.18003137409687 -0.248728454113 -0.44872692227363 -0.68750166893005 0.84836089611053 -0.49515345692634 -0.71375703811645 0.33617293834686 -0.58055818080902 -0.82209664583206 -0.25755333900451 0.31582978367805 -0.0927395671606 0.46614015102386 0.06124122068285 -0.53235149383544 -0.96627259254455 0.16540592908859 0.06904108822345 -0.93281900882721 0.63847684860229 -0.05675909668207 0.69842767715454 -0.96039575338363 -0.87305974960327 0.97444224357605 0.18801675736904 -0.33934590220451 -0.0012511643581 -0.20568051934242 -0.4608829319477 -0.81964272260665 0.60453200340271 0.68994504213333 -0.65562653541565 -0.56693822145462 0.45641887187957 0.94205439090728 0.34160876274108 -0.42105090618133 0.68120157718658 0.8642703294754 0.11898732185363 0.65002489089965 -0.43727365136146 -0.8059714436531 -0.69843780994415 0.38163256645202 0.75681847333908 0.42400258779525 0.9858745932579 0.42196735739708 -0.84087663888931 0.89420926570892 -0.21792398393154 0.12582926452159 0 你可以控制的一个参数是你想用梯度扫描的方向数量。例如，你可以扫描获取64或128张图像，每张图像的扩散梯度从一个稍微不同的方向应用。更多的方向导致了更高的角度分辨率（angular resolution），这使你可以对扩散的方向做出更精细的空间区分。与任何提高分辨率的东西一样，其代价是更多的扫描需要更多的时间。\n5.张量建模 这种bvals和bvecs的组合使我们能够构建一个称为张量（Tensor）的东西，并将其与扩散加权图像的每个体素相匹配。在本教程中，可以把张量看作是沿x、y和z维度推动的力的模型。例如，流经花园水管的水会对管子的边界产生推力，但主要是沿着水管的长度流动。我们把能量的方向称为eigenvectors，特征向量和能量的大小称为eigenvalues,特征值。\n应用于扩散加权图像，我们使用这些相同的概念，将每个体素观察到的信号建模为特征向量和特征值的组合。特征向量表示扩散的方向，而特征值代表扩散的大小。再举花园水管的例子，水的力量沿着管子的长度会有很高的特征向量和特征值；同样，我们可以把大脑中每个体素的扩散建模为特征向量和特征值的组合。一旦我们计算出最能代表当前体素中观察到的信号的数值组合，我们就可以使用一些不同的方程来计算该体素处的扩散的不同属性。这种弥散张量成像的最流行的方程式被称为分数各向异性（FA，Fractional Anisotropy），或简称为FA。这可以用公式来计算： 各向异性是每个体素的特征值的加权和。FA值越高，说明沿某一方向的扩散越大，FA值越低，说明扩散很少，或者扩散不受约束，随意向各个方向扩散（比如说，在脑室）。如果我们发现沿其中一个维度的扩散较大，我们可以根据方向进行颜色编码。**扩散成像的惯例是用红色表示沿X轴的扩散，绿色表示沿Y轴的扩散，蓝色表示沿Z轴的扩散。**下面的图片总结了这个颜色编码方案。 在每个体素上拟合一个张量，可以生成不同类型的扩散图，如各向异性图。Tract-Based Spatial Statistics (TBSS)是一个流行的FSL扩散分析软件包，可用于创建这些地图；类似于fMRI数据的分析，这些地图可被组合成一个组分析地图，并可从地图中的感兴趣区域提取数据。 FSL的TBSS生成的张量。有关如何使用此包分析主题的概述.\n6.其他的扩散衡量指标 虽然FA是最流行的扩散衡量指标，但我们将简要回顾一下其他一些衡量指标：\n平均扩散率 (Mean Diffusivity,MD)：特征值的平均值，通过将特征值相加并除以3来计算。可用于识别大脑病变，例如水肿。 轴向扩散系数 (Axial Diffusivity,AD)：最大特征值的值。 径向扩散率 (Radial Diffusivity,RD)：两个最小特征值的平均值。通常用于分析朝向相同方向的大纤维束，例如胼胝体。 7.扩散张量成像的缺点：交叉纤维问题 尽管自扩散加权成像开始以来，扩散张量成像一直是最受欢迎的分析方法之一，但它一直受到交叉纤维问题的阻碍。上述张量拟合方法对分析只包含单一方向的白质束的体素很有用。另一方面，如果体素含有相互交叉的纤维，该方法会导致虚假的结果。举个最极端的例子，设想我们获得了一个单一体素的弥散加权图像，这个体素包含相互成直角交叉的白质纤维。由于张量被限制在生成一个单一的解决方案，以估计其所有的特征向量和特征值，它无法单独估计每束纤维的扩散方向和幅度。相反，它将分割差异并得出结论，沿任何方向都没有扩散\u0026ndash;换句话说，两个纤维束的扩散将相互抵消。\n白质纤维以直角相互交叉的示意图 为了解决这个问题，人们开发了一种被称为球形反卷积（Spherical Deconvolution）的技术。球形反卷积不是试图为在每个体素测量的复杂信号找到一个单一的解决方案，而是假设扩散信号是你期望从多个单独的纤维在不同角度相互交叉的信号的平均值。因此，单根纤维被用作基础函数来解卷更复杂的信号。\n扩散加权数据从许多不同的角度获取每个体素的扩散信号，以形成扩散方向和扩散幅度的图像。然后，信号被解构为一组在不同方向上的单个纤维。球形反卷积代替了每个体素的单一扩散数，用于生成纤维取向密度函数，或FOD（Fiber Orientation Density function）。该函数被表示为一个具有卵形轴的形状；尽管加载到主要扩散方向的轴的裂片相对于其他轴变得更长、更大，但关于沿其他轴的扩散方向和强度的信息仍然被保留。 图中是一个扩散加权图像，上面覆盖着FODs。如果我们放大前联合的一个区域，我们可以看到ODFs主要是由左至右（这也由它们的红色编码来表示）。请注意，插图右边的ODFs开始变成更多的绿色，代表着方向从主要的左右轴转为前后轴。 另一部分白质显示的FODs主要遵循前后方向；然而，一些ODFs有在前后方向和下至上方向延伸的裂片（下至上方向的颜色被编码为蓝色）。通过这种方式，FODs可以代表纤维沿多个维度的方向。 MRtrix Viewer使用 安装好mrtrix后，在终端输入命令mrview，即可打开MRtrix Viewer对扩散像数据进行可视化查看，点击UI界面上的File -\u0026gt; Open,选择想要查看的扩散像数据，就可以查看扩散像数据。 另外，我们也可以直接将文件拖拽到UI视窗，直接打开扩散像数据、结构像数据。同时，可以选择View -\u0026gt; Ortho view下的选项，调整为三视图模式。 或者，使用终端方式打开一个文件查看，如下图所示：\n$ mrview \u0026lt;*.mif\u0026gt; $ mrview \u0026lt;*.mif\u0026gt; -overlay.load \u0026lt;*.mif\u0026gt; MRtrix Viewer默认显示的第一个体积，其时间序列索引为0，即看起来像典型的 T2 加权功能图像.（0 表示时间序列中的第一个体积，1 表示第二个体积，依此类推），我们可以选择Image -\u0026gt; Next volume或者Image -\u0026gt; Go to volume跳转到不同的volume；视窗的左下角voxel index中最后一位，展示了当前所在的volume是哪个。 如果你发现强度的下降使图像太暗而看不清，你可以通过点击Tool -\u0026gt; View options选项来增加亮度，然后为Intensity scaling栏输入一个较低的最大值。 BTC_preop（Brain Tumor Connectomics Data）数据下载 我们将分析来自openneuro.org的一个名为BTC preop 的数据集。 请点击前往相关网站进行数据下载。 数据集中包括11名神经胶质瘤患者、14名脑膜瘤患者和11名对照受试者的术前数据在论文\u0026quot;Modeling brain dynamics in brain tumor patients using The Virtual Brain\u0026quot;使用。\nMRtrix数据格式与格式转换 MRtrix使用它自己的格式(.mif)来存储和显示成像数据。如果你已经使用过流行的fMRI软件包的教程，如SPM、FSL和AFNI，你可能记得它们都可以读取和写入NIFTI格式的图像。(AFNI默认会以它自己的BRIK/HEAD格式写文件，除非你指定你的输出应该有一个.nii扩展名，但它是唯一的例外)。MRtrix也能读取NIFTI格式的原始数据，但会以MRtrix格式输出文件，标有.mif扩展名。\n要看这是如何工作的，请导航到包含dwi数据的文件夹下，其中包含你的扩散数据。预处理数据的第一步是将扩散数据转换为MRtrix能理解的格式；我们将使用mrconvert命令将原始扩散数据与相应的.bval和.bvec文件结合起来，这样我们就可以将合并的文件用于未来的预处理步骤。\n# mrconvert -h 查看使用说明 # 注意mrconvert可以将mif与nii之间互相转换。 $ mrconvert -h MRtrix 3.0.4 mrconvert Dec 14 2022 mrconvert: part of the MRtrix3 package SYNOPSIS Perform conversion between different file types and optionally extract a subset of the input image USAGE mrconvert [ options ] input output input the input image. output the output image. ... -fslgrad bvecs bvals Provide the diffusion-weighted gradient scheme used in the acquisition in FSL bvecs/bvals format files. If a diffusion gradient scheme is present in the input image header, the data provided with this option will be instead used. ... # 将原始扩散数据与相应的`.bval`和`.bvec`文件结合起来 # mrconvert \u0026lt;input nifti\u0026gt; \u0026lt;output mif\u0026gt; -fslgrad \u0026lt;bvecs\u0026gt; \u0026lt;bvals\u0026gt; $ mrconvert sub-CON02_ses-preop_acq-AP_dwi.nii.gz sub-CON02_ses-preop_acq-AP_dwi.mif -fslgrad sub-CON02_ses-preop_acq-AP_dwi.bvec sub-CON02_ses-preop_acq-AP_dwi.bval # mrinfo \u0026lt;mif file\u0026gt; # 快速查看mif数据的信息 # 输出包含例如数据集的维度和体素大小，以及用于生成当前文件的命令； $ mrinfo sub-CON02_ses-preop_acq-AP_dwi.mif ************************************************ Image name: \u0026#34;sub-CON02_ses-preop_acq-AP_dwi.mif\u0026#34; ************************************************ Dimensions: 96 x 96 x 60 x 102 Voxel size: 2.5 x 2.5 x 2.5 x 8.7 Data strides: [ -1 2 3 4 ] Format: MRtrix Data type: signed 16 bit integer (little endian) Intensity scaling: offset = 0, multiplier = 1 Transform: 0.9988 -0.01395 0.04747 -111 0.02082 0.9888 -0.1476 -85.88 -0.04488 0.1484 0.9879 -56.76 command_history: mrconvert sub-CON02_ses-preop_acq-AP_dwi.nii.gz sub-CON02_ses-preop_acq-AP_dwi.mif -fslgrad sub-CON02_ses-preop_acq-AP_dwi.bvec sub-CON02_ses-preop_acq-AP_dwi.bval (version=3.0.4) comments: TE=1.1e+02;Time=125448.950;phase=1;dwell=0.380 dw_scheme: 0,0,0,0 [102 entries] 0,0,0,0 ... 0.9082055818,0.3669468842,-0.201277434,2800 0,0,0,0 mrtrix_version: 3.0.4 请注意，由于这是一个四维数据集(96 x 96 x 60 x 102)，最后一个维度是时间；换句话说，这个文件包含102个体积(volumes)，每个体积的尺寸是96 x 96 x 60体素。体素大小(Voxel size)字段的最后一个维度值为8.7,表示获取每个体素的时间。这个时间也被称为重复时间(repetition time)，或TR。\n检查Bvals和Bvecs 我们需要检查的其他文件是bvals和bvecs文件。(简而言之，bvals文件包含了每个容积的一个数字，表明应用于数据的扩散梯度有多大；bvecs文件包含了每个容积的三组数字，表明应用梯度的方向是什么。一般来说，具有较大b值的体积对扩散变化更敏感，但图像也更容易受到运动和生理伪影的影响，如下图所示。 三个具有不同b值的容积。b值为0相当于T2加权功能扫描，而较高的b值会导致图像质量下降（但对弥散的敏感性更高）。 其中，最重要的检查是确保bvals的数量和bvecs的数量与数据集中的卷数相同。\n$ mrinfo -size sub-CON02_ses-preop_acq-AP_dwi.mif 96 96 60 102 # 输出mif的信息，使用awk命令，提取输出文本的第4列内容； $ mrinfo -size sub-CON02_ses-preop_acq-AP_dwi.mif | awk \u0026#39;{print $4}\u0026#39; 102 从上述命令，我们得到mif文件中的volumes的数量为102，然后我们再来检查一下bvals和bvecs文件的数量是否一致。\n$ awk \u0026#39;{print NF;exit}\u0026#39; sub-CON02_ses-preop_acq-AP_dwi.bvec 102 $ awk \u0026#39;{print NF}\u0026#39; sub-CON02_ses-preop_acq-AP_dwi.bval 102 AWK中NF用法\n\u0026gt; $NF表示一行数据最后一列的那个值；NF表的是一行数据的列数; \u0026gt; 比如有个文本内容为： \u0026gt; a b c d e \u0026gt; 那么awk \u0026#39;print $NF\u0026#39;会打印出e \u0026gt; awk \u0026#39;print NF\u0026#39;会打印出5，也就是列数； 如果你的数据集中的卷数与bvals和bvecs的数量不一致，你应该向你的扫描技术员检查这个差异；文件可能没有正确上传到服务器，或者可能没有正确获得扩散加权图像。\n学习参考 官网文档 https://andysbrainbook.readthedocs.io/en/latest/MRtrix/MRtrix_Introduction.html https://osf.io/ht7zv https://andysbrainbook.readthedocs.io/en/latest/TBSS/TBSS_Overview.html https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/TBSS/UserGuide "
},
{
	"uri": "https://LiaoPan.github.io/basics/",
	"title": "基础知识",
	"tags": [],
	"description": "",
	"content": "Chapter 1 Basics Discover what this Hugo theme is all about and the core-concepts behind it.\n"
},
{
	"uri": "https://LiaoPan.github.io/mrtrix/preprocessing/",
	"title": "MRtrix3教程 #2 预处理",
	"tags": [],
	"description": "",
	"content": " 简介 dwi_denoise命令使用 mrcalc命令使用 mri_degibbs命令使用 提取反相编码图像(dwiextract、mrcat、mrmath) 将它们放在一起：使用dwipreproc进行预处理(Eddy处理，去除涡流) 检查损坏的切片 生成Mask(dwibiascorrect、dwi2mask) 参考资料 简介 就像其他神经影像学数据一样，扩散数据在分析前应进行预处理。预处理可以去除图像中的噪声源，如运动伪影和其他失真。扩散数据尤其容易受到相位编码方向的影响而产生扭曲的伪影： 一般来说，主要的编码方向\u0026ndash;如前向后(Anterior to Posterior, AP)\u0026ndash;会使大脑的前部看起来更 \u0026ldquo;压扁\u0026rdquo;，就像从前部方向吹来的强风。后至前(Posterior to Anterior,PA)，相位编码方向的情况则相反。有时这些扭曲是非常微妙的，但其他时候它们是明显的。 以下是使用 MRtrix 完成的常见预处理步骤:\ndwi_denoise命令使用 我们要做的第一个预处理步骤是通过使用MRtrix的dwidenoise命令对数据进行去噪。这需要一个输入和一个输出参数，你也可以选择用-noise选项来输出噪声图。比如说：\n# 查看使用说明 $ dwidenoise -h MRtrix 3.0.4 dwidenoise Dec 14 2022 dwidenoise: part of the MRtrix3 package SYNOPSIS dMRI noise level estimation and denoising using Marchenko-Pastur PCA USAGE dwidenoise [ options ] dwi out dwi the input diffusion-weighted image. out the output denoised DWI image. ...... # 运行此命令需要几分钟时间。 $ dwidenoise sub-CON02_ses-preop_acq-AP_dwi.mif sub-CON02_ses-preop_acq-AP_dwi_denoise.mif -noise noise.mif dwidenoise: [100%] preloading data for \u0026#34;sub-CON02_ses-preop_acq-AP_dwi.mif\u0026#34; dwidenoise: [100%] running MP-PCA denoising mrcalc命令使用 一个质量检查是看残差(residuals)是否加载到解剖结构的任何部分。如果是这样，这可能表明大脑区域受到某种伪影或扭曲的影响不成比例。为了计算这个残差，我们将使用另一个MRtrix命令，叫做mrcalc\n$ mrcalc -h MRtrix 3.0.4 mrcalc Dec 14 2022 mrcalc: part of the MRtrix3 package SYNOPSIS Apply generic voxel-wise mathematical operations to images USAGE mrcalc [ options ] operand [ operand ... ] operand an input image, intensity value, or the special keywords \u0026#39;rand\u0026#39; (random number between 0 and 1) or \u0026#39;randn\u0026#39; (random number from unit std.dev. normal distribution) or the mathematical constants \u0026#39;e\u0026#39; and \u0026#39;pi\u0026#39;. ... EXAMPLE USAGES Double the value stored in every voxel: $ mrcalc a.mif 2 -mult r.mif This performs the operation: r = 2*a for every voxel a,r in images a.mif and r.mif respectively. A more complex example: $ mrcalc a.mif -neg b.mif -div -exp 9.3 -mult r.mif This performs the operation: r = 9.3*exp(-a/b) Another complex example: $ mrcalc a.mif b.mif -add c.mif d.mif -mult 4.2 -add -div r.mif This performs: r = (a+b)/(c*d+4.2). ... basic operations -abs (multiple uses permitted) |%1| : return absolute value (magnitude) of real or complex number -neg (multiple uses permitted) -%1 : negative value -add (multiple uses permitted) (%1 + %2) : add values -subtract (multiple uses permitted) (%1 - %2) : subtract nth operand from (n-1)th ... # 使用原始扩散数据减去经过dwidenoise降噪后的数据，会得到相关的残差数据； $ mrcalc sub-CON02_ses-preop_acq-AP_dwi.mif sub-CON02_ses-preop_acq-AP_dwi_denoise.mif -subtract residual.mif mrcalc: [100%] computing: (sub-CON02_ses-preop_acq-AP_dwi.mif - sub-CON02_ses-preop_acq-AP_dwi_denoise.mif) 然后使用mriview软件来查看这个残差图(residual map)。\nmrview residual.mif 常见的是看到大脑的灰色轮廓，如上图所示。然而，灰质和白质内的一切都应该是相对均匀和模糊的；如果你看到任何清晰的解剖标志，如个别的脑回或脑沟，这可能表明大脑的这些部分已经被噪声所破坏(如下图所示)。 如果发生这种情况，你可以将去噪过滤器的范围从默认的5增加到一个更大的数字，如7；\n$ dwidenoise your_data.mif your_data_denoised_7extent.mif -extent 7 -noise noise.mif mri_degibbs命令使用 一个可选的预处理步骤是运行mri_degibbs，它可以从数据中去除吉布斯伪影,Gibbs\u0026rsquo; ringing artifacts。这些伪影看起来像池塘里的涟漪，在b值为0的图像中最为明显,通常表现为紧邻高对比度界面的多条精细平行线。 首先用mrview查看你的扩散数据，确定是否有任何吉布斯伪影；如果有，那么你可以通过指定输入文件和输出文件来运行mrdegibbs，例如:\n$ mrdegibbs -h MRtrix 3.0.4 mrdegibbs Dec 14 2022 mrdegibbs: part of the MRtrix3 package SYNOPSIS Remove Gibbs Ringing Artifacts USAGE mrdegibbs [ options ] in out in the input image. out the output image. DESCRIPTION This application attempts to remove Gibbs ringing artefacts from MRI images using the method of local subvoxel-shifts proposed by Kellner et al. (see reference below for details). .... $ mrdegibbs sub-CON02_ses-preop_acq-AP_dwi_denoise.mif sub-CON02_ses-preop_acq-AP_dwi_den_unr.mif mrdegibbs: [100%] performing Gibbs ringing removal 像往常一样，用mrview检查前后的数据，以确定预处理步骤是否使数据变得更好、更差，或者没有影响。 如果你在你的数据中没有看到任何吉布斯伪影，那么我建议省略这一步骤。\n提取反相编码图像(dwiextract、mrcat、mrmath) 大多数扩散数据是由两个独立的成像文件组成的：一个是以主相位编码方向（primary phase-encoding direction）获取的，一个是以反向相位编码方向获取的。主相位编码方向用于获取不同b值的大部分扩散图像。另一方面，反向相位编码文件用于消除主相位编码文件中存在的任何失真现象。\n为了理解这一点，想象一下，你正在用吹风机吹头发。假设你把吹风机对准你的后脑勺，它把你的头发向前吹，吹到你的脸前；让我们把这称为后部到前部（PA）的相位编码方向。现在你的头发看起来很乱，你想消除空气从后脑勺吹到前脑勺的影响。所以你把吹风机对准你的脸的前面，它把你的头发吹向后面。如果你取其中两次吹风的平均值，你的头发应该回到正常位置。\n同样，我们使用两种相位编码方向，在两者之间创造一种平均值。我们知道这两种相位编码方式都会给数据带来两种独立的、相反的扭曲，但我们可以用消除扭曲来抵消它们。\n我们的第一步是将反向相位编码的NIFTI文件转换为.mif格式。我们还将其b值和b向量添加到mif头文件中。\n$ mrconvert sub-CON02_ses-preop_acq-PA_dwi.nii.gz - -fslgrad sub-CON02_ses-preop_acq-PA_dwi.bvec sub-CON02_ses-preop_acq-PA_dwi.bval | mrmath - mean mean_b0_PA.mif -axis 3 mrconvert: [100%] uncompressing image \u0026#34;sub-CON02_ses-preop_acq-PA_dwi.nii.gz\u0026#34; mrconvert: [100%] copying from \u0026#34;sub-CON02_ses-preop_acq-PA_dwi.nii.gz\u0026#34; to \u0026#34;/var/folde...0gn/T/mrtrix-tmp-XwJdp7.mif\u0026#34; mrmath: [100%] preloading data for \u0026#34;/var/folders/39/93zn2fy95cd9b_b38zvmvgjc0000gn/T/mrtrix-tmp-XwJdp7.mif\u0026#34; mrmath: [100%] computing mean along axis 3... 注意这里的-为临时文件命名方式，我们就可以在|后的shell命令下直接继续使用它。 原PA文件sub-CON02_ses-preop_acq-PA_dwi.nii.gz数据维度为9696602 ,得到的文件mean_b0_PA.mif的数据维度变成了9696*60，即指定了axis=3，将在时间维度（或者说volumes）层面上进行了平均（mean）。\n接下来，我们从初级相位编码图像中提取b值，然后将两者与mrcat结合：\n$ dwiextract -h MRtrix 3.0.4 dwiextract Dec 14 2022 dwiextract: part of the MRtrix3 package SYNOPSIS Extract diffusion-weighted volumes, b=0 volumes, or certain shells from a DWI dataset USAGE dwiextract [ options ] input output input the input DW image. output the output image (diffusion-weighted volumes by default). EXAMPLE USAGES Calculate the mean b=0 image from a 4D DWI series: $ dwiextract dwi.mif - -bzero | mrmath - mean mean_bzero.mif -axis 3 The dwiextract command extracts all volumes for which the b-value is (approximately) zero; the resulting 4D image can then be provided to the ... OPTIONS -bzero Output b=0 volumes (instead of the diffusion weighted volumes, if -singleshell is not specified). -no_bzero Output only non b=0 volumes (default, if -singleshell is not specified). ... $ mrcat -h MRtrix 3.0.4 mrcat Dec 14 2022 mrcat: part of the MRtrix3 package SYNOPSIS Concatenate several images into one USAGE mrcat [ options ] image1 image2 [ image2 ... ] output image1 the first input image. image2 additional input image(s). output the output image. EXAMPLE USAGES Concatenate individual 3D volumes into a single 4D image series: $ mrcat volume*.mif series.mif The wildcard characters will find all images in the current working # 使用dwiextract提取AP方向b值为0的所有volumes，并获取其均值mif文件； $ dwiextract sub-CON02_ses-preop_acq-AP_dwi_denoise.mif - -bzero | mrmath - mean mean_b0_AP.mif -axis 3 # 使用mrcat命令合并两个图像文件,这将创建一个新图像“b0_pair.mif”，其中包含两个相位编码图像的平均b=0图像。 $ mrcat mean_b0_AP.mif mean_b0_PA.mif -axis 3 b0_pair.mif mrcat: [100%] concatenating \u0026#34;mean_b0_AP.mif\u0026#34; mrcat: [100%] concatenating \u0026#34;mean_b0_PA.mif\u0026#34; 将它们放在一起：使用dwipreproc进行预处理(Eddy处理，去除涡流) 现在我们有了运行主要预处理步骤所需的一切，该步骤由dwipreproc调用。在大多数情况下，这个命令是一个包装器，它使用FSL的命令，如topup和eddy，来解除数据的扭曲并去除涡流。在本教程中，我们将使用下面这行代码：\n$ dwifslpreproc -h MRtrix 3.0.4 dwifslpreproc dwifslpreproc: part of the MRtrix3 package SYNOPSIS Perform diffusion image pre-processing using FSL\u0026#39;s eddy tool; including inhomogeneity distortion correction using FSL\u0026#39;s topup tool if possible USAGE dwifslpreproc [ options ] input output input The input DWI series to be corrected output The output corrected image series DESCRIPTION This script is intended to provide convenience of use of the FSL software tools topup and eddy for performing DWI pre-processing, by encapsulating some of the surrounding image data and metadata processing steps. It is intended to simply these processing steps for most commonly-used DWI acquisition strategies, whilst also providing support for some more exotic ... OPTIONS -pe_dir PE Manually specify the phase encoding direction of the input series; can be a signed axis number (e.g. -0, 1, +2), an axis designator (e.g. RL, PA, IS), or NIfTI axis codes (e.g. i-, j, k) -eddy_options \u0026#34; EddyOptions\u0026#34; Manually provide additional command-line options to the eddy command (provide a string within quotation marks that contains at least one space, even if only passing a single command-line option to eddy) -se_epi image Provide an additional image series consisting of spin-echo EPI images, which is to be used exclusively by topup for estimating the inhomogeneity field (i.e. it will not form part of the output image series) ... Options for specifying the acquisition phase-encoding design; note that one of the -rpe_* option s MUST be provided -rpe_none Specify that no reversed phase-encoding image data is being provided; eddy will perform eddy current and motion correction only -rpe_pair Specify that a set of images (typically b=0 volumes) will be provided for use in inhomogeneity field estimation only (using the -se_epi option) -rpe_all Specify that ALL DWIs have been acquired with opposing phase-encoding 第一个参数是输入和输出；第二个选项，-nocleanup将保留临时处理文件夹，其中包含一些我们以后要检查的文件。 -pe_dir AP表示主相位编码方向是从前到后，而-rpe_pair与-se_epi选项相结合，表示下面的输入文件（即 \u0026ldquo;b0_pair.mif\u0026rdquo;）是一对自旋回波图像，是用反向相位编码方向获取的。最后，-eddy_options指定了FSL命令eddy的特定选项。你可以访问eddy用户指南，了解更多的选项和它们的详细作用。现在，我们只使用选项--slm=linear（这对获取的数据少于60个方向的数据很有用）和--data_is_shelled（这表明扩散数据是用多个b值获取的）。\n# dwifslpreproc \u0026lt;input.mif\u0026gt; \u0026lt;output.mif\u0026gt; -nocleanup -pe_dir AP -rpe_pair -se_epi b0_pair.mif -eddy_options \u0026#34; --slm=linear --data_is_shelled\u0026#34; $ dwifslpreproc sub-CON02_ses-preop_acq-AP_dwi_denoise.mif sub-02_den_preproc.mif -nocleanup -pe_dir AP -rpe_pair -se_epi b0_pair.mif -eddy_options \u0026#34; --slm=linear --data_is_shelled\u0026#34; dwifslpreproc: dwifslpreproc: Note that this script makes use of commands / algorithms that have relevant articles for citation; INCLUDING FROM EXTERNAL SOFTWARE PACKAGES. Please consult the help page (-help option) for more information. dwifslpreproc: dwifslpreproc: Generated scratch directory: /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwifslpreproc-tmp-RUWVON/ Command: mrconvert /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/sub-CON02_ses-preop_acq-AP_dwi_denoise.mif /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwifslpreproc-tmp-RUWVON/dwi.mif -json_export /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwifslpreproc-tmp-RUWVON/dwi.json Command: mrconvert /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/b0_pair.mif /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwifslpreproc-tmp-RUWVON/se_epi.mif dwifslpreproc: Changing to scratch directory (/Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwifslpreproc-tmp-RUWVON/) dwifslpreproc: Total readout time not provided at command-line; assuming sane default of 0.1 Command: mrinfo dwi.mif -export_grad_mrtrix grad.b Command: mrconvert se_epi.mif topup_in.nii -import_pe_table se_epi_manual_pe_scheme.txt -strides -1,+2,+3,+4 -export_pe_table topup_datain.txt Command: topup --imain=topup_in.nii --datain=topup_datain.txt --out=field --fout=field_map.nii.gz --config=/Applications/fsl/etc/flirtsch/b02b0.cnf --verbose ... 这个命令可能需要几个小时来运行，这取决于你的计算机速度。对于一台拥有8个处理核心的iMac来说，大约需要2个小时。当它完成后，检查输出，看看涡流校正和取消扭曲如何改变了数据；理想情况下，你应该看到在诸如眶额皮层等区域恢复了更多的信号，这些区域特别容易受到信号丢失的影响。\n然后，我们可以使用mrview命令加载原始数据以及经过处理后的数据，对比查看其预处理效果。\n# mrview \u0026lt;经过预处理后数据\u0026gt; -overlay.load \u0026lt;原始数据\u0026gt; $ mrview sub-02_den_preproc.mif -overlay.load sub-CON02_ses-preop_acq-AP_dwi_denoise.mif 检查损坏的切片 dwifslpreproc命令中的一个选项，\u0026quot;-nocleanup\u0026quot;，保留了一个标题为 \u0026ldquo;tmp \u0026ldquo;的目录。在这个目录中，有一个名为dwi_post_eddy.eddy_outlier_map的文件，它包含了0和1的字符串。每一个1代表一个切片是一个离群点，可能是因为运动量太大、涡流或其他原因。\n下面的代码，从dwi目录下运行，将导航到 \u0026ldquo;tmp \u0026ldquo;文件夹，并计算出离群片的百分比： shell dwi_post_eddy.eddy_outlier_map #/bin/bash set -e # 进入dwifslpreproc-tmp-*临时目录 cd dwifslpreproc-tmp-* # 统计slices数量：找到dwi.mif文件的维度(Dimensions: 96 x 96 x 60 x 102)，,并得到第6列值为60，第8列值为102，相乘计算整体的slices数量； totalSlices=`mrinfo dwi.mif | grep Dimensions | awk \u0026#39;{print $6 * $8}\u0026#39;` # 统计离群点的个数：从前到后累加dwi_post_eddy.eddy_outlier_map文件的数值，然后输出； # 注意这里相对原教程新增了NR\u0026gt;1,原因为目前输出dwi_post_eddy.eddy_outlier_map文件的第一行为说明文字，需要去除第一行，避免统计。 totalOutliers=`awk \u0026#39;NR\u0026gt;1{ for(i=1;i\u0026lt;=NF;i++)sum+=$i } END { print sum }\u0026#39; dwi_post_eddy.eddy_outlier_map` # 如果离群点数量超过10，则建议不要使用该数据； echo \u0026#34;If the following number is greater than 10, you may have to discard this subject because of too much motion or corrupted slices\u0026#34; # 计算离群点的百分比比例： 离群点数量/Slices总数）* 100 echo -n \u0026#34;the percentage of outlier slices:\u0026#34; | tee percentageOutliers.txt echo \u0026#34;scale=5; ($totalOutliers / $totalSlices * 100)/1\u0026#34; | bc | tee -a percentageOutliers.txt cd .. One row per scan, one column per slice. Outlier: 1, Non-outlier: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 生成Mask(dwibiascorrect、dwi2mask) 与fMRI分析一样，创建一个掩膜（mask）来限制你的分析只限于大脑体素是很有用的，这将加速我们的分析速度。\n要做到这一点，事先运行一个叫做dwibiascorrect的命令是很有用的。这可以去除数据中检测到的不均匀性(inhomogeneities)，从而获得更好的掩膜估计。然而，在某些情况下，它可能导致更坏的估计；与所有的预处理步骤一样，你应该在每个步骤前后检查它：\n$ dwibiascorrect -h MRtrix 3.0.4 dwibiascorrect dwibiascorrect: part of the MRtrix3 package SYNOPSIS Perform B1 field inhomogeneity correction for a DWI volume series USAGE dwibiascorrect algorithm [ options ] ... algorithm Select the algorithm to be used to complete the script operation; additional details and options become available once an algorithm is nominated. Options are: ants, fsl Options for importing the diffusion gradient table -grad GRAD Provide the diffusion gradient table in MRtrix format -fslgrad bvecs bvals Provide the diffusion gradient table in FSL bvecs/bvals format ... # 使用dwibiascorrect来消除数据中检测到的不均匀性 $ dwibiascorrect ants sub-02_den_preproc.mif sub-02_den_preproc_unbiased.mif -bias bias.mif dwibiascorrect: dwibiascorrect: Note that this script makes use of commands / algorithms that have relevant articles for citation; INCLUDING FROM EXTERNAL SOFTWARE PACKAGES. Please consult the help page (-help option) for more information. dwibiascorrect: dwibiascorrect: Generated scratch directory: /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwibiascorrect-tmp-PRRP4X/ Command: mrconvert /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/sub-02_den_preproc.mif /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwibiascorrect-tmp-PRRP4X/in.mif dwibiascorrect: Changing to scratch directory (/Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwibiascorrect-tmp-PRRP4X/) Command: dwi2mask in.mif mask.mif Command: dwiextract in.mif - -bzero | mrmath - mean mean_bzero.mif -axis 3 Command: mrconvert mean_bzero.mif mean_bzero.nii -strides +1,+2,+3 Command: mrconvert mask.mif mask.nii -strides +1,+2,+3 Command: N4BiasFieldCorrection -d 3 -i mean_bzero.nii -w mask.nii -o [corrected.nii,init_bias.nii] -s 4 -b [100,3] -c [1000,0.0] Command: mrcalc mean_bzero.mif mask.mif -mult - | mrmath - sum - -axis 0 | mrmath - sum - -axis 1 | mrmath - sum - -axis 2 | mrdump - Command: mrcalc corrected.nii mask.mif -mult - | mrmath - sum - -axis 0 | mrmath - sum - -axis 1 | mrmath - sum - -axis 2 | mrdump - Command: mrcalc init_bias.nii 0.7908883751651254 -mult bias.mif Command: mrcalc in.mif bias.mif -div result.mif Command: mrconvert result.mif /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/sub-02_den_preproc_unbiased.mif Command: mrconvert bias.mif /Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/bias.mif dwibiascorrect: Changing back to original directory (/Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi) dwibiascorrect: Deleting scratch directory (/Volumes/Touch/Datasets/DTI/ds001226-download/sub-CON02/ses-preop/dwi/dwibiascorrect-tmp-PRRP4X/) 上面的命令使用了-ants选项，这需要在你的系统上安装ANTs。我推荐这个程序，但万一你无法安装它，你可以用-fsl选项代替它。\n# 如下展示了未安装ants，造成的dwibiascorrect运行报错信息。 ... dwibiascorrect: [ERROR] Could not find ANTS program N4BiasFieldCorrection; please check installation ... 然后，我们就可以使用dwi2mask创建掩膜，这会将把我们的分析限制在我们想位于大脑内的体素。\n$ MRtrix 3.0.4 dwi2mask Dec 14 2022 dwi2mask: part of the MRtrix3 package SYNOPSIS Generates a whole brain mask from a DWI image USAGE dwi2mask [ options ] input output input the input DWI image containing volumes that are both diffusion weighted and b=0 output the output whole-brain mask image DESCRIPTION All diffusion weighted and b=0 volumes are used to obtain a mask that includes both brain tissue and CSF. In a second step peninsula-like extensions, where the peninsula itself is ... $ dwi2mask sub-02_den_preproc_unbiased.mif mask.mif dwi2mask: [100%] preloading data for \u0026#34;sub-02_den_preproc_unbiased.mif\u0026#34; dwi2mask: [done] computing dwi brain mask dwi2mask: [done] applying mask cleaning filter 使用mrview命令查看mask数据\n$ mrview mask.mif MRtrix的dwi2mask命令在大多数情况下工作得很好。然而，你可以从上面的图片中看到，在脑干和小脑内的掩膜上有几个洞。你可能对这些区域不感兴趣，但建议确保掩膜在任何地方都没有洞。\n为此，你可以使用FSL的bet2这样的命令。例如，你可以使用以下代码将无偏的扩散加权图像转换成NIFTI格式，用bet2创建一个掩膜，然后将掩膜转换成.mif格式：\n$ mrconvert sub-02_den_preproc_unbiased.mif sub-02_unbiased.nii # 注意：在实践中，-f指定为0.2达到了最好的掩膜效果，与原教程0.7有所不同。 $ bet2 sub-02_unbiased.nii sub-02_masked -m -f 0.2 # 注意：在nifti转换为mif文件时，可能存在转换数据类型的报警信息 $ mrconvert sub-02_masked_mask.nii.gz mask.mif 你可能必须对分数强度阈值(fractional intensity threshold)（由-f指定）进行试验，以便产生一个你满意的掩膜。根据我的经验，对大多数大脑来说，这个阈值可以在0.2和0.7之间变化，以便生成一个足够的掩膜。 另外，我们可以使用MRIcron软件的Draw \u0026gt; Open VOI功能，去打开nifti格式的掩膜文件，去逐帧修改，确保掩膜文件不存在漏洞。 参考资料 https://andysbrainbook.readthedocs.io/en/latest/MRtrix/MRtrix_Course/MRtrix_04_Preprocessing.html "
},
{
	"uri": "https://LiaoPan.github.io/dipy/tracking_basic/",
	"title": "纤维束追踪入门",
	"tags": [],
	"description": "",
	"content": "Basic Tracking(Local fiber tracking) 本教程知识点：\n如何使用扩散像数据集来实现纤维束重建 1)从扩散数据集获取方向(directions)的方法。 2)识别追踪何时必须停止的方法。 3)设置追踪种子(seed)。 如何保存trk文件 使用StatefulTractogram()和save_trk()函数保存trk文件 局部纤维跟踪(Local fiber tracking)是一种通过从局部方向信息创建流线(streamlines)来模拟白质纤维的方法。其思想如下:如果一个区域/路径段的局部方向是已知的，可以沿着这些方向进行集成，以构建该结构的完整表示。局部纤维束追踪因其简单、鲁棒性好而被广泛应用于扩散MRI领域。\n步骤一. 从扩散数据集获取方向(directions)的方法\n基于 Constant Solid Angle ODF模型来拟合数据，该模型会评估每个voxel的取向分布函数(ODF,Orientation Distribution Function)。OODF 是作为方向函数的水扩散分布。ODF的峰值是图像中某一点上束段(tract segments)方向的良好估计。在这里，我们使用peaks_from_model来拟合数据，并计算白质所有体素中的纤维方向。\n步骤二. 识别追踪何时必须停止的方法\n接下来，我们需要用某种方法将纤维追踪限制在具有良好方向性信息的区域。我们已经创建了白质掩码(white mask)，但我们可以更进一步，通过对广义分数各向异性（GFA,generalized fractional anisotropy）进行阈值处理，将纤维追踪限制在那些ODF显示出明显限制性扩散的区域。\n步骤三. 设置追踪种子(seed)\n在我们开始追踪之前，我们需要指定在哪里 \u0026ldquo;seed\u0026rdquo;（开始）纤维追踪。一般来说，选择的种子将取决于人们感兴趣的建模路径。在这个例子中，我们将在胼胝体的矢状切面上使用一个每个体素的2x2x2的网格种子。从这个区域进行追踪将给我们一个胼胝体束的模型。这个切片在标签的图像中具有标签值2。\n使用EuDX算法构建一个确定性的纤维束流线(streamlines)。 所谓的确定性(deterministic)表示如果你重复纤维跟踪（保持所有输入相同），你将得到完全相同的一组纤维束流线。\nJupyter已省略部分内容，请点击这里全屏显示 使用csdeconv.mask_for_response_ssst()函数来获取每个体素的各向异性配置（very anisotropic configurations）的信息，该函数会返回所选体素的mask。 通过这个mask，我们就可以通过csdeconv.response_from_mask_ssst()函数计算响应函数。\nload_nifti_data()和load_nifti()函数的区别:\nload_nifti_data()只加载nifti内的data array。\nload_nifti()除了加载data array,还要把其他信息也加载进来（data, img.affine, img, vox_size, nib.aff2axcodes(img.affine)）。\n方向场（Direction Field）图如何看？\nx - Red - 方向场图中为红色标识\ny - Green - 方向场图中为绿色标识\nz - Blue- 方向场图中为蓝色标识\n"
},
{
	"uri": "https://LiaoPan.github.io/datasets/",
	"title": "脑相关数据集",
	"tags": [],
	"description": "",
	"content": "数据集 在我们学习相关软件的过程中，官网本身会提供一些用于实践的数据集，这些数据集用来给大家尝试、学习使用。 本文会记录总结常用的相关数据集，供大家方便下载使用，方便后续大家跟着教程一起实践。\nSPM相关数据集下载地址: www.fil.ion.ucl.ac.uk/spm/data/\n简介： 提供在学习SPM教程过程的数据集\nOpeneuro(推荐): openneuro.org\n简介： 提供包括MEG、EEG、PET、MRI、fMRI等模态的开源数据集下载。\nOpenfmri: openfmri.org\n简介： 提供fMRI的开源数据集下载。\nDIPY: dipy.org\n简介： 提供纤维束相关的开源数据集下载。\n"
},
{
	"uri": "https://LiaoPan.github.io/freesurfer/basic/",
	"title": "FreeSurfer教程 #2. FreeSurfer输出结果与FreeView可视化",
	"tags": [],
	"description": "",
	"content": " 0. 本文知识点汇总 1. 教程数据准备 FreeSurfer 的输出结果 使用FreeView来图片查看Volumes 使用FreeView来3D查看Surfaces 参考资料 0. 本文知识点汇总 FreeSurfer输出结果的简单理解 使用FreeView对FreeSurfer的结果（Volumes、Surfaces）进行可视化查看 1. 教程数据准备 在FsTutorial_Data下载相关教程的测试数据，大概8GB。\n使用命令行下载相关教程数据，也可以直接访问网址下载，然后解压。\ncurl https://surfer.nmr.mgh.harvard.edu/pub/data/tutorial_data.tar.gz -o tutorial_data.tar.gz tar -xzvf tutorial_data.tar.gz rm tutorial_data.tar.gz export TUTORIAL_DATA=/path/to/your/tutorial/dir # 定义环境变量TUTORIAL_DATA ls $TUTORIAL_DATA buckner_data fsfast-functional diffusion_recons fsfast-tutorial.subjects diffusion_tutorial long-tutorial FreeSurfer 的输出结果 surf 文件夹下生成 . white、. sphere、. inflated 等网格点文件，每一个文件里面都存储了大脑皮质表面网格点的三维坐标及相邻顶点构成的三角面片信息。\nsurf 文件夹下生成基于曲面的形态特征数据，不同的特征采用不同的文件后缀名，\n皮质厚度（ . thickness ） 雅可比度量（. jacobian. white） 脑沟（ . sulc ） 曲率（. curv） 外表面积（. area） 体积（. volume）等面数据文件，其坐标索引号与 Mesh 网格序号一致。 **stats **文件夹下，对于每个脑图谱(atlas)都有一个分区结果(parcellations)。比如，\nlh.aparc.annot，使用Desikan-Killiany图谱的左半球的分区结果；\nlh.aparc.a2009s.annot,使用Destrieux图谱的左半球分区结果；\naseg.stats包含了所有图谱的分割结果。如果想知道怎么提取这些信息，请跳转。\nDesikan-Killiany图谱与Destrieux图谱的区别在于，Destrieux图谱包含更多的分区，可以适用于更加精细化的分析。 使用FreeView来图片查看Volumes freeview -v \\ good_output/mri/T1.mgz \\ good_output/mri/wm.mgz \\ good_output/mri/brainmask.mgz \\ good_output/mri/aseg.mgz:colormap=lut:opacity=0.2 \\ -f good_output/surf/lh.white:edgecolor=blue \\ good_output/surf/lh.pial:edgecolor=red \\ good_output/surf/rh.white:edgecolor=blue \\ good_output/surf/rh.pial:edgecolor=red -v 用于加载volumes; -f 用于加载surfaces; 更多详细了解，请参考官网教程\n使用FreeView来3D查看Surfaces 下述Surfaces都可以使用FreeView进行查看。\npial(软膜), white(白质) and inflated surface(膨胀表面) sulcal(脑沟) and curvature maps(曲率图) thickness maps(厚度图) cortical parcellation(皮质分割) freeview -f good_output/surf/lh.pial:annot=aparc.annot:name=pial_aparc:visible=0 \\ good_output/surf/lh.pial:annot=aparc.a2009s.annot:name=pial_aparc_des:visible=0 \\ good_output/surf/lh.inflated:overlay=lh.thickness:overlay_threshold=0.1,3::name=inflated_thickness:visible=0 \\ good_output/surf/lh.inflated:visible=0 \\ good_output/surf/lh.white:visible=0 \\ good_output/surf/lh.pial \\ --viewport 3d 参数以:+\u0026lt;cmd\u0026gt;=进行间隔区分,比如:annot=、:name=、:overlay=、:overlay_threshold=；\nlh.pial:annot=aparc.annot表示在pial表面上加载Desikan-Killiany皮质分区； lh.pial:annot=aparc.a2009s.annot表示在pial表面加载Destrieux皮质分区； :name=pial_aparc:visible=0 表示更改显示名称并关闭该层显示； lh.inflated:overlay=lh.thickness:overlay_threshold=0.1,3表示加载膨胀表面顶部的厚度叠加层并设置要显示的最小和最大阈值；\n绿色区域是脑回，红色区域是脑沟 上图为Desikan-Killiany Cortical Parcellation 上图为Destrieux Cortical Parcellation 上述皮质分割可通过recon-all来生成，对应命令为： ?h.aparc.annot:\nDesikan-Killiany atlas ?h.aparc.a2009s.annot:\nDestrieux atlas FreeView的简单使用方法，不需要每次在终端命令行输入命令来指定打开什么文件以及展示属性，而是仅输入freeview打开UI界面，点击操作即可，方便又快捷！\n更多细节参考和练习，请访问FreeviewGuide\nFreeSurfer 采用的是 RAS 坐标系，其意义为 R：right，X 轴正方向；A：anterior，Y 轴正方向；S：superior，Z 轴正方向。\n参考资料 官网 Freesurfer源码 官网使用手册 中文使用手册 FreeSurfer官网教程 FreeSurfer Ouputs "
},
{
	"uri": "https://LiaoPan.github.io/dipy/",
	"title": "DIPY系列教程",
	"tags": [],
	"description": "",
	"content": "DIPY简介 DIPY是Python中标准的3D/4D成像库，包含空间归一化、信号处理、机器学习、统计分析和医学图像可视化的通用方法。此外，它还包含计算解剖学的专门方法，包括扩散、灌注和结构成像。\nDIPY功能 命令行接口 所有算法都可以使用命令行的方式调用 创建自己的命令行 统计分析 BUAN AFQ K折交叉验证 重构 Single Shell:DTI, CSA, SFM, SDT, Q-Ball, CSD, \u0026hellip; Multi-Shell:GQI, DTI, DKI, SHORE, MAPMRI, MSMT-CSD, \u0026hellip; 配准 仿射变换 2D/3D微分同胚配准（Diffeomorphic 2D/3D Registration） 纤维束成像 概率性纤维束追踪 确定性纤维束追踪 PFT纤维束追踪 去噪 Patch2self Gibbs Unringing LPCA - MPPCA Non Local Means 可视化 ODFs可视化 交互式的纤维束可视化 预处理 Brain extraction SNR estimation Reslice Datasets 安装方式 $ pip install nibabel # 用于读写神经影像数据 $ pip install dipy $ pip install fury # 某些可视化依赖库 当然，也可以使用conda方式进行安装。\n更多安装教程，请参考官网\n如果看到这不知道什么是pip或者conda，可以去学习一下python相关基础。\n教程数据下载 使用python代码下载，数据集默认会下载在主目录下的.dipy目录内。 Jupyter已省略部分内容，请点击这里全屏显示 尽量不要使用jupyter来执行上述命令下载数据，因为目前jupyter的下载进度支持不好，无法查看下载是否已完成且容易僵住。\n使用命令行工具下载,选择特定目录，执行下面命令即可(推荐) $ dipy_fetch list # 查看所有可使用的数据集 INFO:Please, select between the following data names: bundle_atlas_hcp842, bundle_fa_hcp, bundles_2_subjects, cenir_multib, cfin_multib, file_formats, fury_surface, gold_standard_io, isbi2013_2shell, ivim, mni_template, qtdMRI_test_retest_2subjects, qte_lte_pte, resdnn_weights, scil_b0, sherbrooke_3shell, stanford_hardi, stanford_labels, stanford_pve_maps, stanford_t1, syn_data, taiwan_ntu_dsi, target_tractogram_hcp, tissue_data $ dipy_fetch {specific_dataset} --out_dir {specific_data_out_folder} # 选择特定数据集，下载到特定目录，注意{}内内容需要替换。 $ dipy_fetch sherbrooke_3shell --out_dir . # 举例，将sherbrooke_3shell数据集下载到当前目录。 使用dipy_fetch时，\u0026ndash;out_dir不写，即下载到默认目录下(~/.dipy)\n注意 1: 不需要马上下载上述所有数据集，在后续教程中，会陆续使用命令下载教程相关数据。 注意 2: 在下载过程中，经常会碰到报500错误(HTTP Error 500: Internal Server Error)的情况，重新开始即可。\n"
},
{
	"uri": "https://LiaoPan.github.io/mrtrix/",
	"title": "MRtrix3系列教程",
	"tags": [],
	"description": "",
	"content": " 简介 下载安装 校验是否安装成功 简介 MRtrix3提供了一套工具来进行各种类型的弥散MRI分析，从各种形式的纤维束成像到下一代的组水平分析。它的设计考虑到了一致性、性能和稳定性，并以开源许可的方式免费提供。它是由该领域的专家团队开发和维护的，培养了一个由不同背景的用户组成的活跃社区。\n与主要图像格式无缝交互 FOD-based（Fiber Orientation Distributions，FOD） DEC maps and panchromatic sharpening 下载安装 访问MRtrix的下载地址,选择不同平台进行安装即可。\nmacOS Linux sudo bash -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/MRtrix3/macos-installer/master/install)\u0026#34; 该脚本会自动下载MRtrix3软件的最新的二进制发布版本，解压到/usr/local/mrtrix3目录下。\n$ conda install -c mrtrix3 mrtrix3 前提，需要先安装anaconda (or miniconda)。\n如果碰到macOS安装时，无法正常下载install脚本，可以通过网页访问raw.githubusercontent.com/MRtrix3/macos-installer/master/install，然后自己创建文件进行安装。下面是我安装时的install脚本内容。\n#!/bin/bash -e tag=$(basename $(/usr/bin/curl -Ls -o /dev/null -w %{url_effective} https://github.com/MRtrix3/mrtrix3/releases/latest)) if [ -z \u0026#34;${tag}\u0026#34; ]; then echo \u0026#34;ERROR: could not find tag name for latest release ...\u0026#34; exit fi if [ \u0026#34;$1\u0026#34; != \u0026#34;-f\u0026#34; ]; then echo \u0026#34;This installer will download MRtrix ${tag} and install it to /usr/local/mrtrix3.\u0026#34; echo \u0026#34;In addition it will:\u0026#34; echo \u0026#34;* create symbolic links in /usr/local/bin to the binaries in /usr/local/mrtrix3/bin\u0026#34; echo \u0026#34;* create symbolic links in /Applications to the app bundles in /usr/local/mrtrix3/bin\u0026#34; fi if [ $EUID != 0 ]; then echo \u0026#34;ERROR: This script requires root privileges, please run as: sudo \u0026#34;$0\u0026#34; \u0026#34;$@\u0026#34;\u0026#34; exit fi if [ -d \u0026#34;/usr/local/mrtrix3\u0026#34; ] || [ -L \u0026#34;/usr/local/mrtrix3\u0026#34; ] ; then echo \u0026#34;WARNING: /usr/local/mrtrix3 already exists and will be replaced during installation.\u0026#34; fi if [ \u0026#34;$1\u0026#34; != \u0026#34;-f\u0026#34; ]; then while true; do read -p \u0026#34;Are you sure you want to continue? [y/n] \u0026#34; yn case $yn in [Yy]* ) break;; [Nn]* ) exit;; esac done fi if [ ! -d \u0026#34;/usr/local/bin\u0026#34; ]; then if [ -e \u0026#34;/usr/local/bin\u0026#34; ]; then echo \u0026#34;WARNING: /usr/local/bin is not a directory, cannot create symlinks\u0026#34; else echo \u0026#34;WARNING: /usr/local/bin does not exist, creating it for you.\u0026#34; mkdir -p -m 755 /usr/local/bin fi fi url=https://github.com/MRtrix3/mrtrix3/releases/download/${tag}/mrtrix3-macos-${tag}.tar.gz if [ -z \u0026#34;${url}\u0026#34; ]; then echo \u0026#34;ERROR: Could not find tarball of latest release ...\u0026#34; exit fi echo \u0026#34;Downloading \u0026#34;${url}\u0026#34; ...\u0026#34; /usr/bin/curl -sL \u0026#34;${url}\u0026#34; -O tarball=$(basename \u0026#34;${url}\u0026#34;) if [ ! -f \u0026#34;${tarball}\u0026#34; ]; then echo \u0026#34;ERROR: Download not sucessful ...\u0026#34; exit fi if [ -f /usr/local/mrtrix3/symlinks ]; then echo \u0026#34;Removing symbolic links of previous installation ...\u0026#34; for l in $(cat /usr/local/mrtrix3/symlinks); do if [ -L \u0026#34;${l}\u0026#34; ]; then unlink \u0026#34;${l}\u0026#34; fi done fi if [ -d \u0026#34;/usr/local/mrtrix3\u0026#34; ] || [ -L \u0026#34;/usr/local/mrtrix3\u0026#34; ] ; then echo \u0026#34;Removing previous installation in /usr/local/mrtrix3 ...\u0026#34; rm -rf \u0026#34;/usr/local/mrtrix3\u0026#34; fi for l in /usr/local/bin/*; do if [ -L \u0026#34;${l}\u0026#34; ]; then t=\u0026#34;$(readlink \u0026#34;${l}\u0026#34;)\u0026#34; if [[ \u0026#34;${t}\u0026#34; == *\u0026#34;mrtrix3\u0026#34;* ]]; then echo \u0026#34;WARNING: Removing symbolic link \u0026#34;${l}\u0026#34; to \u0026#34;${t}\u0026#34; (conflicting homebrew installation?) ...\u0026#34; unlink \u0026#34;${l}\u0026#34; fi fi done echo \u0026#34;Unpacking \u0026#34;${tarball}\u0026#34; to /usr/local/mrtrix3 ...\u0026#34; tar oxf \u0026#34;${tarball}\u0026#34; -C /usr/local rm \u0026#34;${tarball}\u0026#34; echo \u0026#34;Fixing python shebang ...\u0026#34; cd /usr/local/mrtrix3/bin for f in $(grep -lr \u0026#39;^#!/usr/bin/env python\u0026#39;); do sed -i \u0026#39;\u0026#39; \u0026#39;s|^#!/usr/bin/env python$|#!/usr/bin/python3|\u0026#39; ${f} done echo \u0026#34;Applying patch to show correct version numbers in scripts ...\u0026#34; cd /usr/local/mrtrix3 curl -s https://github.com/MRtrix3/mrtrix3/commit/4a293d30e1c0686037ae637f67932d497eb71ee6.patch | patch -s -p1 echo \u0026#34;Creating symlinks in /usr/local/bin ...\u0026#34; cd /usr/local/bin touch /usr/local/mrtrix3/symlinks for target in $(find ../mrtrix3/bin -maxdepth 1 -type f ! -name \u0026#34;*.*\u0026#34;); do ln -sf \u0026#34;${target}\u0026#34; echo /usr/local/bin/\u0026#34;$(basename \u0026#34;${target}\u0026#34;)\u0026#34; \u0026gt;\u0026gt; /usr/local/mrtrix3/symlinks done echo \u0026#34;Creating symlinks in /Applications ...\u0026#34; cd /Applications for target in /usr/local/mrtrix3/bin/*.app; do ln -sf \u0026#34;${target}\u0026#34; echo /Applications/\u0026#34;$(basename \u0026#34;${target}\u0026#34;)\u0026#34; \u0026gt;\u0026gt; /usr/local/mrtrix3/symlinks done if [[ $SHELL = \u0026#34;/bin/zsh\u0026#34; ]]; then profile=~/.zprofile; else profile=~/.bash_profile; fi echo \u0026#34;$PATH\u0026#34; | grep -q \u0026#39;/usr/local/bin:\u0026#39; || printf \u0026#34;WARNING: /usr/local/bin is not in PATH. You can add it to the PATH with:\\necho \u0026#39;export PATH=/usr/local/bin:\\$PATH\u0026#39; \u0026gt;\u0026gt; ${profile}\\n\u0026#34; echo \u0026#34;Installation complete!\u0026#34; $ touch install #创建脚本文件，然后粘贴上述脚本内容。 $ chmod +x install $ sudo ./install # 执行安装,若因为github的原因导致无法下载，建议在terminal内配置github代理，或者手动下载软件包，修改install脚本,让其读取本地已下载的软件包安装即可。 校验是否安装成功 新起一个terminal，随意选择MRtrix的命令，输入部分命令，比如dwi2,然后按tab键，输入dwi2mask -h,如果可以正常显示命令,那么就应该安装成功了。\n$ dwi2mask -h dwi2mask: part of the MRtrix3 package SYNOPSIS Generates a whole brain mask from a DWI image USAGE dwi2mask [ options ] input output input the input DWI image containing volumes that are both diffusion weighted and b=0 output the output whole-brain mask image DESCRIPTION All diffusion weighted and b=0 volumes are used to obtain a mask that includes both brain tissue and CSF. 官网地址 - GitHub源码地址 - MRtrix官网文档地址\n"
},
{
	"uri": "https://LiaoPan.github.io/afni/",
	"title": "AFNI系列教程",
	"tags": [],
	"description": "",
	"content": " 在fMRI相关分析软件中，AFNI是最难学习的，如果第一次没学懂，咱多看看、多实践，不用害怕去尝试它。\n介绍 AFNI (Analysis of Functional NeuroImages)是一个领先的功能神经图像分析软件套件，包含 C、Python、R 程序和 shell 脚本，主要开发用于分析和显示多种 MRI 模态：解剖、功能 MRI (FMRI) 和扩散加权 (DWI) 数据。它是免费提供的（作为开源代码和预编译的二进制文件）用于研究目的。该软件几乎可以在任何带有 X11 和 Motif 显示的 Unix 系统上运行。为 MacOS 和 Linux 系统提供二进制包，例如 Fedora、CentOS/Red Hat 和 Ubuntu（包括用于 Linux 的 Windows 子系统）。\nAFNI能解决什么问题？ APQC: afni_proc.py质量控制 帮助研究者检查已处理过的数据。\ngraph LR a(AFNI基本操作)--\u0026gt;b(数据预处理) a(AFNI基本操作)--\u0026gt;d(时间校正) a(AFNI基本操作)--\u0026gt;c(头动校正) a--\u0026gt;f(空间配准) a--\u0026gt;e(空间平滑和时间序列的标注化) a--\u0026gt;g(一般线性模型) a--\u0026gt;h(组分析) 时间校正 在MRI扫描过程中，有两种方法：\n顺序切片采集 按照顺序从上到下、从下到上进行采集。\n交错切片采集 每采集一张切片后隔一张再采集，然后第二遍进行间隙填充。\n即从扫描开始的第一个切片到最后一个切片之间存在一定的时间差，导致采集到的数据并不是同一个时间点。\n脚本：3dTshift\n配准与标准化 每个人的大脑存在差异，在进行组分析时，需要将个体的大脑体素都对应到相同的大脑模板上再进行分析。\n脚本：align_epi_anat.py\n对准和运动校正 在MRI扫描过程中，被试头部可能存在轻微扰动，对于成像结果造成干扰，故我们需要对头动进行校正。\n刚体变换：采用刚体变换来解决头动问题，如果我们设定一个参考点，然后检测到受试者的头部向哪个方向移动了，那么我们只需要将图像的切片向相反的方向移动同样的距离即可，当然，不只是平移，包括旋转等。\n脚本：volreg\n平滑 平滑就是用周围体素的平均值代替当前体素，这对使得图像变得模糊，分辨率降低。但是平滑对与fMRI来说是非常有效的，因为fMRI的噪音较大，平滑后可以显著降噪，同时增强信号。平滑核函数一般包括两个：4mm和10mm，越大的核函数平滑程度更大，当然图像分辨率也越低。\n脚本：blur\nmask和体素缩放 mask 设置一个掩膜(mask)只把头部纳入进来，其余部分都去掉。去结构像的mask，然后应用到功能像上。\n体素缩放 不同受试者的图像之间像素强度可能存在差异，这样的分析结果不会有任何意义，所我我们将每个体素的时间序列缩放为100的平均值（范围0-200）。\n脚本：3dAutomask\n检查预处理结果 数据准备： https://openneuro.org/datasets/ds000102/versions/00001\n参考资料 AFNI官网文档 https://www.cnblogs.com/kongmaster/p/16635637.html "
},
{
	"uri": "https://LiaoPan.github.io/eeglab/",
	"title": "EEGLAB系列教程",
	"tags": [],
	"description": "",
	"content": "测试一下\n"
},
{
	"uri": "https://LiaoPan.github.io/fieldtrip/",
	"title": "FieldTrip系列教程",
	"tags": [],
	"description": "",
	"content": "测试一下\n"
},
{
	"uri": "https://LiaoPan.github.io/freesurfer/",
	"title": "FreeSurfer系列教程",
	"tags": [],
	"description": "",
	"content": "介绍 FreeSurfer是一款免费开源的用于分析和可视化来自横断面和纵向研究的神经影像数据软件包。它由 Martinos 生物医学成像中心的计算神经成像实验室开发。\nFreeSurfer 为结构像和功能像提供完整的处理流，包括提供线性和非线性配准、皮质和皮质下分割、皮质表面重建、组形态测量统计分析、扩散像、PET分析等的工具。它也是 Human Connectome Project 的首选结构像分析软件。\n有关使用和理解 FreeSurfer 工具的扩展文档，请访问FS Wiki。\nFreeSurfer能解决什么问题？ MRI的图像分割、配准 颅骨剥离，B1偏场校正，灰白色质分割 个体皮质表面与立体定向图谱的非线性配准 皮质表面重建 计算皮质厚度、曲率、灰质体积等 皮层表面区域以及皮层下的大脑结构的标记 组间差异分析以及可视化 参考资料 官网 Freesurfer使用手册 "
},
{
	"uri": "https://LiaoPan.github.io/mne/",
	"title": "MNE系列教程",
	"tags": [],
	"description": "",
	"content": "更多的MNE使用技巧参考\n"
},
{
	"uri": "https://LiaoPan.github.io/spm/",
	"title": "SPM系列教程",
	"tags": [],
	"description": "",
	"content": "SPM介绍 SPM(Statistical Parametric Mapping)分析功能成像数据主流的一个开源软件包，可以分析多种脑成像数据，包括fMRI，PET，SPECT，EEG和MEG。 SPM软件包专为分析脑成像数据序列而设计，这些序列包括不同队列（cohorts）的一系列图像或者同一个被试的时间序列。\n中文版SPM初学者教程 原版SPM12 Starter\u0026rsquo;s GUIDE\nhttps://jsheunis.github.io/2018-06-28-spm12-matlab-scripting-tutorial-4/ 汇总\n"
},
{
	"uri": "https://LiaoPan.github.io/ants/",
	"title": "ANTs系列教程",
	"tags": [],
	"description": "",
	"content": " 下载ANTs工具箱 安装ANTs工具箱 设置环境变量PATH、ANTSPATH 下载ANTs工具箱 点击下载链接，选择想要的版本进行下载。 Mac环境下，等待下载完成后，解压到特定文件下/opt/ants-\u0026lt;version\u0026gt;/[bin,lib]，\n安装ANTs工具箱 设置环境变量PATH、ANTSPATH 在Mac环境下，打开~/.bash_profile文件,写入下述内容：\n# ANTs export ANTSPATH=/opt/ants-2.4.4/bin/ export PATH=${ANTSPATH}:$PATH 然后，source ~/.bash_profile来激活环境变量。 最后，我们来检查安装是否成功。\n# 在终端输入以下命令，会输出antsRegistration的对应路径 $ which antsRegistration /opt/ants-2.4.4/bin//antsRegistration # 在终端输入以下命令，会输出antsRegistrationSyN.sh的使用方法 $ antsRegistrationSyN.sh Usage: antsRegistrationSyN.sh -d ImageDimension -f FixedImage -m MovingImage -o OutputPrefix Example Case: antsRegistrationSyN.sh -d 3 -f fixedImage.nii.gz -m movingImage.nii.gz -o output Compulsory arguments: -d: ImageDimension: 2 or 3 (for 2 or 3 dimensional registration of single volume) -f: Fixed image(s) or source image(s) or reference image(s) ... 若在mac环境下，使用ANTs命令时，出现以下问题，我们就需要给所有相关二进制文件授权。 授权方式如下：\n$ xattr -r -d com.apple.quarantine \u0026lt;指定授权文件夹\u0026gt; $ xattr -r -d com.apple.quarantine /opt/ants-2.4.4/ https://github.com/ANTsX/ANTsPy https://github.com/ANTsX/ANTs\nhttps://github.com/ANTsX/ANTs/wiki/Installing-ANTs-release-binaries https://andysbrainbook.readthedocs.io/en/latest/ANTs/ANTs_Overview.html?highlight=ants\n"
},
{
	"uri": "https://LiaoPan.github.io/freesurfer/practice/",
	"title": "FreeSurfer教程 #N. 实践教程之CookBook",
	"tags": [],
	"description": "",
	"content": " 实践#1:如何将一个个体subject映射到fsaverage？ 实践2:如何提取stats文件夹内的统计信息？ 实践#3:如何提取感兴趣ROI区域的结构信息？ 实践#4:如果构建一个surface ROI重采样到体积（Volume）？ 实践#5:如何使用FreeSurfer去除颅骨(skull-stripping)? 实践#1:如何将一个个体subject映射到fsaverage？ 如何按自定义模板，重建皮层，并提取皮层信息？\n实践2:如何提取stats文件夹内的统计信息？ 方法: 使用asegstats2table和aparcstats2table命令来提取 $ asegstats2table --subject \u0026lt;\u0026gt; --common-segs --meas \u0026lt;volume,mean,std\u0026gt; --stats=\u0026lt;stats file\u0026gt; --table=\u0026lt;extracted measurement to a text file\u0026gt; $ asegstats2table --subjects sub-101 sub-103 --common-segs --meas volume --stats=aseg.stats --table=segstats.txt --subjects选项指定了一个被试名称的列表。 --common-segs表示输出所有被试共有的分段，换句话说，如果一个受试者的分段数与其他受试者不同，不要以错误退出命令。 --meas表示要从表中提取哪种结构测量值（\u0026ldquo;volume \u0026ldquo;是默认值；替代值是 \u0026ldquo;mean \u0026ldquo;和 \u0026ldquo;std\u0026rdquo;）。 --stats指的是将从分段数据中提取的统计文件； --table将提取的测量数据写入一个文本文件，按被试名称组织。\n同理，aparcstats2table也类似，\n$ aparcstats2table --subjects sub-101 sub-103 --hemi lh --meas thickness --parc=aparc --tablefile=aparc.txt --hemi,指定要分析的半球 --meas,要提取的测量值,选项有\u0026quot;thickness\u0026rdquo;, \u0026ldquo;volume\u0026rdquo;, \u0026ldquo;area\u0026rdquo;, \u0026ldquo;meancurv\u0026rdquo; --parc,指定图谱，选项有Desikan-Killinay图谱(\u0026ldquo;aparc\u0026rdquo;)和Destrieux图谱(\u0026ldquo;aparc.a2009s\u0026rdquo;)\n实践#3:如何提取感兴趣ROI区域的结构信息？ 如何将一个Volumetric ROI重采样到表面，然后从该ROI中提取结构测量值。 如何将ROI区域映射到皮层上 shell #!/bin/tcsh setenv SUBJECTS_DIR `pwd` # 使用AFNI的3dUndump创建5mm的ROI球体;ROI_file.txt 包含球心的 x、y 和 z 坐标 # https://afni.nimh.nih.gov/pub/dist/doc/program_help/3dUndump.html 3dUndump -srad 5 -prefix S2.nii -master MNI_caez*+tlrc.HEAD -orient LPI -xyz ROI_file.txt # 使用tkmedit查看 # https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/TkmeditGeneralUsage tkmedit -f MNI_caez_N27.nii -overlay S2.nii -fthresh 0.5 # 将结构像模板配准到fsaverage fslregister --s fsaverage --mov MNI_caez_N27.nii --reg tmp.dat # 在fsaverage上查看ROI tkmedit fsaverage T1.mgz -overlay S2.nii -overlay-reg tmp.dat -fthresh 0.5 -surface lh.white -aux-surface rh.white #将ROI映射到fsaverage皮层; #https://surfer.nmr.mgh.harvard.edu/fswiki/mri_vol2surf mri_vol2surf --mov S2.nii \\ --reg tmp.dat \\ --projdist-max 0 1 0.1 \\ --interp nearest \\ --hemi lh \\ --out lh.fsaverage.S2.mgh \\ --noreshape # 检查ROI映射到膨胀皮层的情况 # https://surfer.nmr.mgh.harvard.edu/fswiki/tksurfer tksurfer fsaverage lh inflated -overlay lh.fsaverage.S2.mgh -fthresh 0.5 实践#4:如果构建一个surface ROI重采样到体积（Volume）？ 将一个由FreeSurfer创建的ROI投射到个体体积空间。\n根据label信息，生成ROI Volume。 shell # 手动创建registration file（register.dat） # https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/ManualRegistration # 去掉--noedit参数，可以弹出GUI界面来手动调整；“beta_0001.nii” is a beta map created in the subject’s native space tkregister2 --mov beta_0001.nii --s subject --noedit --regheader --reg register.dat # 使用mri_label2vol命令将surface ROI转到体积空间。 # mri_label2vol: creates mgz volume from a label or set of labels # --temp: Template volume # --fillthresh: Relative threshold which the number hits in a voxel must exceed for the voxel to be considered a candidate for membership in the label. (See mri_label2vol --help for more information) # --proj: Project the label along the surface normal # https://surfer.nmr.mgh.harvard.edu/fswiki/mri_label2vol mri_label2vol --label lh.superiortemporal.label --temp beta_0001.nii --subject subject --hemi lh --fillthresh .9 --proj frac 0 1 .1 --reg register.dat --o $PWD/stgnew.nii mri_label2vol运行完成之后，我们得到一个新文件stgnew.ni，它是转换为体积空间的表面ROI。\n实践#5:如何使用FreeSurfer去除颅骨(skull-stripping)? shell # 通过设置较低的分水岭阈值（例如 5）来去除更多的头骨,会生成颅骨去除的掩码文件brainmask.mgz。 recon-all -skullstrip -wsthresh 5 -clean-bm -s sub-117_ses-BL_T1w # 即使分水岭阈值较低，仍有一些头骨(skull)和硬脑膜(dura)的碎片残留。你可以使用-gcut选项来删除后者 recon-all -skullstrip -clean-bm -gcut -subjid sub-117_ses-BL_T1w 在你使用watershed的gcut选项后，需要用以下代码重新生成皮层表面。 recon-all -autorecon2-pial -subjid \u0026lt;subject name\u0026gt;\n参数解析：\n-subjid subjid:the subject data upon which to operate autorecon2-pial:process stages 21-23 https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all 扩展 可以使用FSL下的bet2工具来完成颅骨去除(很常用)。\n参考教程\n"
},
{
	"uri": "https://LiaoPan.github.io/",
	"title": "主页",
	"tags": [],
	"description": "",
	"content": "教程\u0026amp;学习内容 本博客是博主边学习相关知识边记录的相关教程实践，以作备忘和分享。 博主在学习过程中，难免会出现错漏或者理解不对的地方，请大家辩证看待、谨慎使用。\n因为在国内访问github网站时偶尔会出现访问缓慢或者无法访问情况，所以我在gitee也搭建了相同博客网站，供大家访问。 https://panliao.gitee.io/ （国内访问，更加稳定）\n基础知识 脑相关数据集 DIPY系列教程 快速入门 纤维束追踪入门 MRtrix3系列教程 MRtrix3教程 #1 快速入门 MRtrix3教程 #2 预处理 AFNI系列教程 EEGLAB系列教程 FieldTrip系列教程 FreeSurfer系列教程 FreeSurfer教程 #1. 安装 FreeSurfer教程 #2. FreeSurfer输出结果与FreeView可视化 FreeSurfer教程 #N. 实践教程之CookBook MNE系列教程 SPM系列教程 ANTs系列教程 如果我们想深入了解MRI相关知识，推荐查看 Functional Magnetic Resonance Imaging, by Huettel, Song, \u0026amp; McCarthy (3rd Edition)\n或者访问https://mriquestions.com/index.html网站了解\n"
},
{
	"uri": "https://LiaoPan.github.io/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "https://LiaoPan.github.io/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]